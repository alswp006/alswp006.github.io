---
layout: base
---

<img
  src="https://hits.sh/{{ site.url | remove_first: 'https://' | remove_first: 'http://' }}{{ page.url | replace:'index.html','' | append: '.svg' | replace: '/.svg', '.svg' }}?view=today-total&style=flat-square&label=Today/Total&color=4fb1ba&labelColor=243241"
  alt="" role="presentation">
<div style="padding-bottom:40px;"></div>

{% include_cached components/post.html post=page no_link_title=true no_excerpt=true hide_image=page.hide_image
hide_description=page.hide_description %}

<div class="post-container">
  <div class="post-content">
    <div class="post">
      <article class="post-article">
        {{ content }}
      </article>
    </div>
  </div>
</div>

<div class="toc" id="tocDesktop" style="opacity:0;pointer-events:none">
  <a href="#">&lt;맨 위로&gt;</a>
  {% include toc.html html=content %}
</div>

<!-- Mobile TOC FAB -->
<button class="toc-fab" id="tocFab" aria-label="목차 열기" aria-expanded="false">
  <span class="material-icons" aria-hidden="true">toc</span>
</button>
<div class="toc-mobile-overlay" id="tocOverlay"></div>
<div class="toc-mobile-panel" id="tocMobilePanel" role="navigation" aria-label="목차">
  <a href="#">&lt;맨 위로&gt;</a>
  {% include toc.html html=content %}
</div>

{% assign addons = page.addons | default:site.hydejack.post_addons %}
{% unless addons %}{% assign addons = "about,newsletter,related,random" | split:"," %}{% endunless %}

{% for addon in addons %}
{% case addon %}
{% when 'about' %}
{% include_cached components/about.html author=page.author %}
{% when 'related' %}
{% include components/related-posts.html %}
{% when 'comments' %}
{% include body/comments.html %}
{% else %}
{% endcase %}
{% endfor %}

<script>
(function() {
  var toc = document.getElementById('tocDesktop');
  var article = document.getElementsByClassName("post-article")[0];
  var title = document.querySelector('.post-title');
  if (!toc || !article) return;

  // === 1. TOC 표시/숨김: IntersectionObserver로 제목 감시 ===
  if (title && window.IntersectionObserver) {
    var tocObserver = new IntersectionObserver(function(entries) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          // 제목이 보임 → TOC 숨김
          toc.style.opacity = '0';
          toc.style.pointerEvents = 'none';
        } else {
          // 제목이 안 보임 (위로 스크롤됨) → TOC 표시
          toc.style.opacity = '1';
          toc.style.pointerEvents = 'auto';
        }
      });
    }, { threshold: 0 });
    tocObserver.observe(title);
  }

  // === 2. 활성 헤딩 추적 ===
  function getTOCNodes(master) {
    var nodes = Array.prototype.slice.call(master.getElementsByTagName("*"), 0);
    return nodes.filter(function (elem) { return elem.tagName === "A"; });
  }
  function getHeaderNodes(master) {
    var nodes = Array.prototype.slice.call(master.getElementsByTagName("*"), 0);
    return nodes.filter(function (elem) {
      return /^H[1-6]$/.test(elem.tagName);
    });
  }

  var headerNodes = getHeaderNodes(article);
  var tocNodes = getTOCNodes(toc);
  var before;
  var ticking = false;

  window.addEventListener('scroll', function () {
    if (ticking) return;
    ticking = true;
    requestAnimationFrame(function () {
      var current = headerNodes.filter(function (header) {
        var headerY = window.pageYOffset + header.getBoundingClientRect().top;
        return window.scrollY >= headerY - 60;
      });

      if (current.length > 0) {
        current = current[current.length - 1];
        var currentA = tocNodes.filter(function (tocNode) {
          return tocNode.innerHTML === current.innerHTML;
        })[0];

        if (currentA) {
          if (!before) before = currentA;
          if (before !== currentA) {
            before.classList.remove("toc-active");
            before = currentA;
          }
          currentA.classList.add("toc-active");
        } else {
          if (before) before.classList.remove("toc-active");
        }
      } else {
        if (before) before.classList.remove("toc-active");
      }
      ticking = false;
    });
  }, false);

  // === 3. Mobile TOC FAB ===
  var fab = document.getElementById('tocFab');
  var overlay = document.getElementById('tocOverlay');
  var panel = document.getElementById('tocMobilePanel');
  if (fab && overlay && panel) {
    function toggleMobileToc(open) {
      var isOpen = typeof open === 'boolean' ? open : !panel.classList.contains('toc-mobile-open');
      panel.classList.toggle('toc-mobile-open', isOpen);
      overlay.classList.toggle('toc-mobile-open', isOpen);
      fab.setAttribute('aria-expanded', String(isOpen));
      fab.setAttribute('aria-label', isOpen ? '목차 닫기' : '목차 열기');
    }
    fab.addEventListener('click', function() { toggleMobileToc(); });
    overlay.addEventListener('click', function() { toggleMobileToc(false); });
    panel.querySelectorAll('a').forEach(function(link) {
      link.addEventListener('click', function() { toggleMobileToc(false); });
    });
  }
})();
</script>
