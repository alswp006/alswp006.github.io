---
layout: base
---

<img
  src="https://hits.sh/{{ site.url | remove_first: 'https://' | remove_first: 'http://' }}{{ page.url | replace:'index.html','' | append: '.svg' | replace: '/.svg', '.svg' }}?view=today-total&style=flat-square&label=Today/Total&color=4fb1ba&labelColor=243241"
  alt="" role="presentation">
<div style="padding-bottom:40px;"></div>

{% include_cached components/post.html post=page no_link_title=true no_excerpt=true hide_image=page.hide_image
hide_description=page.hide_description %}

<div class="post-container">
  <div class="post-content">
    <div class="post">
      <article class="post-article">
        {{ content }}
      </article>
    </div>
  </div>
</div>

<div class="toc" id="tocDesktop">
  <a href="#">&lt;맨 위로&gt;</a>
  {% include toc.html html=content %}
</div>

<!-- Mobile TOC FAB -->
<button class="toc-fab" id="tocFab" aria-label="목차 열기" aria-expanded="false">
  <span class="material-icons" aria-hidden="true">toc</span>
</button>
<div class="toc-mobile-overlay" id="tocOverlay"></div>
<div class="toc-mobile-panel" id="tocMobilePanel" role="navigation" aria-label="목차">
  <a href="#">&lt;맨 위로&gt;</a>
  {% include toc.html html=content %}
</div>

{% assign addons = page.addons | default:site.hydejack.post_addons %}
{% unless addons %}{% assign addons = "about,newsletter,related,random" | split:"," %}{% endunless %}

{% for addon in addons %}
{% case addon %}
{% when 'about' %}
{% include_cached components/about.html author=page.author %}
{% when 'related' %}
{% include components/related-posts.html %}
{% when 'comments' %}
{% include body/comments.html %}
{% else %}
{% endcase %}
{% endfor %}

<script>
(function() {
  // TOC를 body 직접 하위로 이동 (hy-push-state의 transform 영향 제거)
  var toc = document.getElementById('tocDesktop');
  if (toc) {
    document.body.appendChild(toc);
    toc.style.display = 'none'; // 초기에는 숨김
  }

  function getTOCNodes(master) {
    var nodes = Array.prototype.slice.call(master.getElementsByTagName("*"), 0);
    return nodes.filter(function (elem) { return elem.tagName === "A"; });
  }

  function getHeaderNodes(master) {
    var nodes = Array.prototype.slice.call(master.getElementsByTagName("*"), 0);
    return nodes.filter(function (elem) {
      return /^H[1-6]$/.test(elem.tagName);
    });
  }

  var article = document.getElementsByClassName("post-article")[0];
  if (!article || !toc) return;

  var headerNodes = getHeaderNodes(article);
  var tocNodes = getTOCNodes(toc);
  var before;
  var ticking = false;

  function updateTocVisibility() {
    var articleRect = article.getBoundingClientRect();
    // 본문이 화면 위로 스크롤된 후 ~ 본문 끝 전까지만 표시
    if (articleRect.top < 0 && articleRect.bottom > 200) {
      toc.style.display = '';
    } else {
      toc.style.display = 'none';
    }
  }

  document.addEventListener('scroll', function () {
    if (ticking) return;
    ticking = true;
    requestAnimationFrame(function () {
      // TOC 표시/숨김
      updateTocVisibility();

      // 활성 헤딩 추적
      var current = headerNodes.filter(function (header) {
        var headerY = window.pageYOffset + header.getBoundingClientRect().top;
        return window.scrollY >= headerY - 60;
      });

      if (current.length > 0) {
        current = current[current.length - 1];
        var currentA = tocNodes.filter(function (tocNode) {
          return tocNode.innerHTML === current.innerHTML;
        })[0];

        if (currentA) {
          if (!before) before = currentA;
          if (before !== currentA) {
            before.classList.remove("toc-active");
            before = currentA;
          }
          currentA.classList.add("toc-active");
        } else {
          if (before) before.classList.remove("toc-active");
        }
      } else {
        if (before) before.classList.remove("toc-active");
      }
      ticking = false;
    });
  }, false);

  // Mobile TOC FAB
  var fab = document.getElementById('tocFab');
  var overlay = document.getElementById('tocOverlay');
  var panel = document.getElementById('tocMobilePanel');
  if (fab && overlay && panel) {
    function toggleMobileToc(open) {
      var isOpen = typeof open === 'boolean' ? open : !panel.classList.contains('toc-mobile-open');
      panel.classList.toggle('toc-mobile-open', isOpen);
      overlay.classList.toggle('toc-mobile-open', isOpen);
      fab.setAttribute('aria-expanded', String(isOpen));
      fab.setAttribute('aria-label', isOpen ? '목차 닫기' : '목차 열기');
    }
    fab.addEventListener('click', function() { toggleMobileToc(); });
    overlay.addEventListener('click', function() { toggleMobileToc(false); });
    panel.querySelectorAll('a').forEach(function(link) {
      link.addEventListener('click', function() { toggleMobileToc(false); });
    });
  }
})();
</script>
